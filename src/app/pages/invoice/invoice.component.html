<div class="container-fluid py-3">
  <div class="page-title">
    <h2 class="mb-1">Invoice Tracker</h2>
    <p class="text-muted mb-4">
      Track COGS, Fixed Expenses, and Other Invoices separately.
    </p>
  </div>

  <div class="filters-bar">
    <div class="filter-item">
      <label class="filter-label">
        <i class="pi pi-map-marker"></i> Locations
      </label>

      <p-multiSelect
        [options]="locations"
        [(ngModel)]="selectedLocation"
        optionLabel="location_name"
        placeholder="Select locations"
        [maxSelectedLabels]="3"
        display="chip"
        styleClass="w-100"
        (onChange)="onLocationsChange()"
      ></p-multiSelect>
    </div>

    <div class="filter-item">
      <label class="filter-label">
        <i class="pi pi-calendar"></i> Date Range
      </label>

      <p-datepicker
        [(ngModel)]="dateRange"
        selectionMode="range"
        dateFormat="dd/mm/yy"
        [showIcon]="true"
        [readonlyInput]="true"
        placeholder="Select date range"
        styleClass="w-100"
        (ngModelChange)="onLocationsChangeDate($event)"
      ></p-datepicker>
    </div>
  </div>

  <div class="summary-row">
    <p-card class="sum-card sum-cogs" (click)="activeTab = 1">
      <div class="sum-inner">
        <div class="sum-top">
          <i class="pi pi-wallet"></i>
          <span class="sum-title">COGS</span>
        </div>

        <div class="sum-value">{{ totalCat1 | number : "1.2-2" }}</div>
        <div class="sum-sub">{{ cantidadCat1 }} entries</div>
      </div>
    </p-card>

    <p-card class="sum-card sum-fixed" (click)="activeTab = 2">
      <div class="sum-inner">
        <div class="sum-top">
          <i class="pi pi-briefcase"></i>
          <span class="sum-title">Fixed Expense</span>
        </div>

        <div class="sum-value">{{ totalCat2 | number : "1.2-2" }}</div>
        <div class="sum-sub">{{ cantidadCat2 }} entries</div>
      </div>
    </p-card>

    <p-card class="sum-card sum-other" (click)="activeTab = 3">
      <div class="sum-inner">
        <div class="sum-top">
          <i class="pi pi-file"></i>
          <span class="sum-title">Other Invoice</span>
        </div>

        <div class="sum-value">{{ totalCat3 | number : "1.2-2" }}</div>
        <div class="sum-sub">{{ cantidadCat3 }} entries</div>
      </div>
    </p-card>

    <p-card class="sum-card sum-unsig" (click)="activeTab = 4">
      <div class="sum-inner">
        <div class="sum-top">
          <i class="pi pi-file"></i>
          <span class="sum-title">Unassigned Invoice</span>
        </div>

        <div class="sum-value">{{ totalCat4 | number : "1.2-2" }}</div>
        <div class="sum-sub">{{ cantidadCat4 }} entries</div>
      </div>
    </p-card>
  </div>

  <div class="invoice-actions mb-2">
    <button
      pButton
      type="button"
      label="Add COGS Invoice"
      icon="pi pi-plus"
      class="p-button-success action-btn"
      (click)="openAddInvoice(1)"
    ></button>

    <button
      pButton
      type="button"
      label="Add Fixed Expense"
      icon="pi pi-plus"
      class="p-button-info action-btn"
      (click)="openAddInvoice(2)"
    ></button>

    <button
      pButton
      type="button"
      label="Add Other Invoice"
      icon="pi pi-plus"
      class="p-button-warning action-btn"
      (click)="openAddInvoice(3)"
    ></button>
  </div>

  <div class="card">
    <p-tabView>
      <p-tabPanel header="COGS Invoice">
        <app-invoice-table
          [items]="invoice01"
          [tabKey]="1"
          (edit)="openUpdateInvoice($event, 1)"
          (remove)="openDeleteInvoice($event)"
        ></app-invoice-table>
      </p-tabPanel>

      <p-tabPanel header="Fixed Expense">
        <app-invoice-table
          [items]="invoice02"
          [tabKey]="2"
          (edit)="openUpdateInvoice($event, 2)"
          (remove)="openDeleteInvoice($event)"
        ></app-invoice-table>
      </p-tabPanel>

      <p-tabPanel header="Other Invoice">
        <app-invoice-table
          [items]="invoice03"
          [tabKey]="3"
          (edit)="openUpdateInvoice($event, 3)"
          (remove)="openDeleteInvoice($event)"
        ></app-invoice-table>
      </p-tabPanel>

      <p-tabPanel header="Unassigned Invoice">
        <app-invoice-table
          [items]="invoice04"
          [tabKey]="4"
          (edit)="openUpdateInvoice($event, 4)"
          (remove)="openDeleteInvoice($event)"
        ></app-invoice-table>
      </p-tabPanel>
    </p-tabView>
  </div>
</div>

<app-invoice-upd-ins
  *ngIf="showAddLocationModal"
  [mode]="modalMode"
  (close)="closeModal()"
  (submit)="handleSubmit($event)"
  [invoice]="editingInvoice"
  [categoryType]="selectedCategoryType"
>
</app-invoice-upd-ins>
